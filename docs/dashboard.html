<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Dashboard – MomentumXLab</title>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Orbitron', sans-serif;
      background-color: #121212;
      background-image: url('https://www.transparenttextures.com/patterns/carbon-fibre.png');
      color: #f2f2f2;
      text-align: center;
      padding-top: 50px;
    }
    h1 {
      font-size: 32px;
      color: #00ffff;
      text-shadow: 0 0 8px #0ff;
    }
    #content {
      margin-top: 30px;
      font-size: 18px;
    }
    .button {
      margin-top: 20px;
      padding: 12px 20px;
      font-size: 16px;
      background-color: #0af;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      box-shadow: 0 0 10px #0af;
      transition: 0.3s;
      display: inline-block;
    }
    .button:hover {
      background-color: #08d;
      box-shadow: 0 0 16px #0cf;
    }
    #expiredMsg {
      margin-top: 20px;
      color: orange;
    }
  </style>
</head>
<body>
  <h1>MomentumXLab Dashboard</h1>
  <div id="content">Loading your subscription details...</div>
  <button class="button" id="downloadBtn" onclick="download()">Download Pro-4 Trial</button>
  <p id="downloadStatus"></p>
  <p id="expiredMsg"></p>
  <button class="button" onclick="logout()">Logout</button>

  <!-- Upgrade Plan Buttons -->
  <div id="upgradeOptions" style="margin-top:40px; display:none;">
    <h2>Upgrade Your Plan</h2>
    <button class="button" onclick="upgradeTo('Pro-5')">Upgrade to Pro-5</button>
    <button class="button" onclick="upgradeTo('Core-X')">Upgrade to Core-X</button>
  </div>

  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyDeUaFNrqo5DKQWuWz1kiru1MVOSuRHDmk",
      authDomain: "momentumxlab-37ce2.firebaseapp.com",
      projectId: "momentumxlab-37ce2"
    };
    firebase.initializeApp(firebaseConfig);

    let uid = null;
    const stripeLinks = {
      "Pro-5": "https://buy.stripe.com/test_Pro5Link",
      "Core-X": "https://buy.stripe.com/test_CoreXLink"
    };

    firebase.auth().onAuthStateChanged(user => {
      if (user) {
        uid = user.uid;
        const ref = firebase.firestore().collection("users").doc(uid);
        ref.get().then(doc => {
          if (doc.exists) {
            const data = doc.data();
            document.getElementById("content").innerHTML = `
              <p><strong>Plan:</strong> ${data.plan}</p>
              <p><strong>Activated:</strong> ${data.activated ? "Yes" : "No"}</p>
              <p><strong>Paid Date:</strong> ${data.paidDate}</p>
              <p><strong>Expires:</strong> ${data.expires || "Not set"}</p>
            `;

            const expiredDate = new Date(data.expires);
            const now = new Date();

            if (data.pro4TrialDownloaded) {
              document.getElementById("downloadBtn").style.display = "none";
              document.getElementById("downloadStatus").textContent = "✅ You've already downloaded the Pro-4 trial";
            }

            if (now > expiredDate && data.plan === "Free") {
              document.getElementById("expiredMsg").textContent = "❌ Your trial has expired. Please upgrade your plan to continue";
              document.getElementById("upgradeOptions").style.display = "block";
            }
          }
        });
      } else {
        window.location.href = "login.html";
      }
    });

    function download() {
      const link = "https://your-storage-url.com/pro-4-trial.zip"; // เปลี่ยนเป็นลิงก์ของคุณ
      window.open(link, "_blank");
      firebase.firestore().collection("users").doc(uid).update({
        pro4TrialDownloaded: true,
        downloadedAt: new Date().toISOString()
      });
      document.getElementById("downloadBtn").style.display = "none";
      document.getElementById("downloadStatus").textContent = "✅ Download completed";
    }

    function upgradeTo(plan) {
      window.open(stripeLinks[plan], "_blank");
    }

    function logout() {
      firebase.auth().signOut().then(() => {
        window.location.href = "login.html";
      });
    }
  </script>
</body>
</html>
