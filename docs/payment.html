<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Payment</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="style.css" />
</head>
<body class="dark-theme">
  <div class="container">
    <h1>Complete Your Payment</h1>
    <form id="paymentForm">
      <input type="email" id="email" placeholder="Email" required />
      <input type="text" id="fullName" placeholder="Full Name" required />
      <input type="tel" id="phone" placeholder="Phone Number" required />
      <input type="text" id="mt5Account" placeholder="MT5 Account Number" required />
      <input type="text" id="server" placeholder="Broker Server" required />
      <button type="submit" id="payBtn">Pay Now</button>
    </form>
    <div id="errorBox"></div>
  </div>

  <script>
    // Load stored values
    window.onload = function () {
      const fields = ['email', 'fullName', 'phone', 'mt5Account', 'server'];
      fields.forEach(f => {
        const value = localStorage.getItem(f);
        if (value) document.getElementById(f).value = value;
      });
    };

    // Stripe integration
    document.getElementById('paymentForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      const formData = {
        email: email.value,
        fullName: fullName.value,
        phone: phone.value,
        mt5Account: mt5Account.value,
        server: server.value
      };

      try {
        // Optional: Store formData if needed later
        Object.keys(formData).forEach(key => localStorage.setItem(key, formData[key]));

        // Replace with actual Stripe logic
        const response = await fetch('/create-checkout-session', {
          method: 'POST',
          headers: {'Content-Type': 'application/json'},
          body: JSON.stringify(formData)
        });
        const session = await response.json();
        if (session?.id) {
          window.location.href = session.url;
        } else {
          throw new Error('Stripe session error');
        }
      } catch (err) {
        document.getElementById('errorBox').innerText = 'Payment failed. Please try again.';
      }
    });
  </script>
</body>
</html>
