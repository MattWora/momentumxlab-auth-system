<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Payment – MomentumXLab</title>
  <link rel="stylesheet" href="style.css"/>
</head>
<body>
  <section class="pro4-section">
    <div class="left-content">
      <h2>Confirm Payment</h2>
      <div class="info-box">
        <p><strong>Product:</strong> <span id="package-name">—</span></p>
        <p><strong>Price:</strong> <span id="package-price">—</span></p>
        <p><strong>Status:</strong> Pending</p>
      </div>
      <button class="cta-btn" id="pay-btn">Pay Now</button>
      <p class="note">
        Your license will activate immediately after payment is completed.
      </p>
    </div>

    <div class="right-content">
      <div class="mockup-wrapper">
        <img id="product-image" src="" alt="Product Visual"/>
      </div>
    </div>
  </section>

  <footer class="footer-section">
    <div class="footer-logo-left">
      <img src="momentumxlab-logo.png" alt="MomentumXLab Logo"/>
    </div>
    <div class="footer-text">
      <p>Please ensure the accuracy of your order before payment.</p>
      <p class="copyright">© 2025 MomentumXLab. All rights reserved.</p>
    </div>
  </footer>

  <!-- SweetAlert2 for user-friendly alerts -->
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <!-- Stripe.js -->
  <script src="https://js.stripe.com/v3/"></script>

  <script>
    // Replace with your own Publishable Key from Stripe Dashboard
    const stripe = Stripe("pk_test_YOUR_PUBLISHABLE_KEY");

    // Read plan & package from URL
    const params = new URLSearchParams(window.location.search);
    const plan = (params.get("plan") || "").toLowerCase();
    const pkg  = (params.get("package") || "").toLowerCase();

    // Mappings
    const planNames = {
      pro4:  "ApexXAU Intelligent Pro-4",
      pro5:  "ApexXAU Intelligent Pro-5",
      corex: "ApexXAU Intelligent Core-X"
    };
    const packagePrices = {
      pro4:  { monthly: 19.99, "6m": 106.99, "12m": 193.99 },
      pro5:  { monthly: 39.99, "6m": 213.99, "12m": 388.29 },
      corex: { monthly: 49.99, "6m": 267.49, "12m": 485.42 }
    };
    const planImages = {
      pro4:  "Pro4_CollectorEdition_whiteBG.png",
      pro5:  "Pro5_CollectorEdition_whiteBG.png",
      corex: "CoreX_PerformanceEdition_whiteBG.png"
    };

    const infoBox     = document.querySelector(".info-box");
    const nameEl      = document.getElementById("package-name");
    const priceEl     = document.getElementById("package-price");
    const imageEl     = document.getElementById("product-image");
    const payBtn      = document.getElementById("pay-btn");

    // Validate inputs & populate UI
    if (!planNames[plan] || !packagePrices[plan]?.[pkg]) {
      infoBox.innerHTML = `
        <p>Error loading package. Please check your link.</p>
      `;
      payBtn.style.display = "none";
    } else {
      const displayName = `${planNames[plan]} – ${pkg.toUpperCase()}`;
      const displayPrice = `$${packagePrices[plan][pkg].toFixed(2)}`;

      nameEl.textContent  = displayName;
      priceEl.textContent = displayPrice;
      imageEl.src         = planImages[plan];
      imageEl.alt         = planNames[plan];

      payBtn.addEventListener("click", onPayNow);
    }

    async function onPayNow() {
      payBtn.disabled = true;
      try {
        // Call your backend to create a Stripe Checkout session
        const res = await fetch(
          "https://us-central1-momentumxlab-37ce2.cloudfunctions.net/createStripeSession",
          {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ plan, package: pkg })
          }
        );

        if (!res.ok) {
          throw new Error("Failed to initiate payment.");
        }

        const { sessionId } = await res.json();

        // Redirect to Stripe Checkout
        const { error } = await stripe.redirectToCheckout({ sessionId });
        if (error) {
          throw error;
        }
      } catch (err) {
        Swal.fire({
          icon: "error",
          title: "Payment Error",
          text: err.message || "Please try again later."
        });
        payBtn.disabled = false;
      }
    }
  </script>
</body>
</html>
```
